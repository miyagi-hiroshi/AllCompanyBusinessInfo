---
description: å…±é€šã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
globs: ["shared/**/*.ts", "server/**/*.ts", "client/**/*.ts"]
alwaysApply: true
---

# å…±é€šã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

## ğŸ¯ å‹å®šç¾©ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å‹ã®é…ç½®ã¨ç®¡ç†
- **å…±é€šå‹**: sharedãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å…±é€šåŒ–
- **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹**: å³å¯†ãªå‹å®šç¾©
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹**: Drizzle ORMã‚¹ã‚­ãƒ¼ãƒã¨ã®é€£æº
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‹**: Zodã‚¹ã‚­ãƒ¼ãƒã¨ã®é€£æº

### å‹é…ç½®åˆ¤æ–­åŸºæº–

#### `@shared/types/`ã«é…ç½®ã™ã¹ãå‹
- **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–“ã§å…±é€š
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å‹**: è¤‡æ•°æ©Ÿèƒ½ã§ä½¿ç”¨
- **å…±é€šãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‹**: æ¤œç´¢ãƒ»çµã‚Šè¾¼ã¿ã§ä½¿ç”¨
- **èªè¨¼ãƒ»èªå¯å‹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã€æ¨©é™æƒ…å ±

#### `@shared/schema/{æ©Ÿèƒ½å}/types`ã«é…ç½®ã™ã¹ãå‹
- **ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰å‹**: ç‰¹å®šã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«ç‰¹åŒ–
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹**: Drizzleã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰è‡ªå‹•ç”Ÿæˆ
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‹**: Zodã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰è‡ªå‹•ç”Ÿæˆ
- **æ©Ÿèƒ½å›ºæœ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å‹**: ç‰¹å®šæ©Ÿèƒ½ã§ã®ã¿ä½¿ç”¨

#### åˆ¤æ–­åŸºæº–
- **è¤‡æ•°æ©Ÿèƒ½ã§ä½¿ç”¨** â†’ `@shared/types/`
- **ç‰¹å®šæ©Ÿèƒ½ã®ã¿ä½¿ç”¨** â†’ `@shared/schema/{æ©Ÿèƒ½å}/types`
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£** â†’ `@shared/schema/{æ©Ÿèƒ½å}/types`
- **APIé–¢é€£** â†’ `@shared/types/`

### å‹é…ç½®ã®ä½¿ç”¨é »åº¦åŸºæº–

#### ä½¿ç”¨é »åº¦ã®åˆ¤æ–­åŸºæº–
- **3ã¤ä»¥ä¸Šã®æ©Ÿèƒ½ã§ä½¿ç”¨** â†’ `@shared/types/`
- **2ã¤ã®æ©Ÿèƒ½ã§ä½¿ç”¨** â†’ æ©Ÿèƒ½ã®é–¢é€£æ€§ã§åˆ¤æ–­
- **1ã¤ã®æ©Ÿèƒ½ã®ã¿ä½¿ç”¨** â†’ `@shared/schema/{æ©Ÿèƒ½å}/types`

#### æ©Ÿèƒ½ã®é–¢é€£æ€§åˆ¤æ–­åŸºæº–
- **åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆä¾‹ï¼šé¡§å®¢ç®¡ç†ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ï¼‰** â†’ `@shared/types/`
- **åŒã˜APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚°ãƒ«ãƒ¼ãƒ—** â†’ `@shared/types/`
- **åŒã˜ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å…±æœ‰** â†’ `@shared/types/`
- **ç•°ãªã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³** â†’ `@shared/schema/{æ©Ÿèƒ½å}/types`

#### å‹é…ç½®åˆ¤æ–­ä¾‹
```typescript
// @shared/types/ ã«é…ç½®ã™ã¹ãå‹
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  message?: string;
}

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  limit: number;
}

export interface User {
  id: string;
  name: string;
  email: string;
  createdAt: Date;
}

// @shared/schema/customer/types ã«é…ç½®ã™ã¹ãå‹
export interface Customer {
  id: string;
  code: string;
  name: string;
  industry: string;
  createdAt: Date;
}

export interface CustomerFilter {
  search?: string;
  industry?: string;
  status?: 'active' | 'inactive';
}

// åˆ¤æ–­ãŒå›°é›£ãªå ´åˆã®ä¾‹
// 2ã¤ã®æ©Ÿèƒ½ã§ä½¿ç”¨ã™ã‚‹å ´åˆ
export interface Project {
  id: string;
  name: string;
  customerId: string;
  status: 'planning' | 'active' | 'completed';
}

// â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã¨é¡§å®¢ç®¡ç†ã®ä¸¡æ–¹ã§ä½¿ç”¨
// â†’ é–¢é€£æ€§ãŒé«˜ã„ãŸã‚ @shared/types/ ã«é…ç½®
```

### å‹å®šç¾©è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// shared/types/customer.ts
export interface Customer {
  id: string;
  code: string;
  name: string;
  createdAt: Date;
}

export interface CreateCustomerData {
  code: string;
  name: string;
}

export interface CustomerFilter {
  search?: string;
  status?: string;
}

// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  message?: string;
}

// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å‹
export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  limit: number;
}
```

## ğŸ”— APIè¨­è¨ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **ãƒ‘ã‚¹è¨­è¨ˆ**: `/api/feature-name`å½¢å¼
- **ã‚µãƒ–æ©Ÿèƒ½**: `/api/feature-name/sub-feature`å½¢å¼
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: `/api/v1/feature-name`å½¢å¼ï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¨­è¨ˆ
```typescript
// ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹
export interface CreateRequest<T> {
  data: T;
}

export interface UpdateRequest<T> {
  id: string;
  data: Partial<T>;
}

export interface DeleteRequest {
  id: string;
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface SuccessResponse<T> {
  success: true;
  data: T;
}

export interface ErrorResponse {
  success: false;
  message: string;
  code?: string;
}
```

## ğŸ“Š ã‚¹ã‚­ãƒ¼ãƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
shared/
â”œâ”€â”€ schema/
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ tables.ts      # Drizzleãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
â”‚   â”‚   â”œâ”€â”€ types.ts       # å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ index.ts       # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆé›†ç´„
â”‚   â”œâ”€â”€ customer/
â”‚   â”‚   â”œâ”€â”€ tables.ts
â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ index.ts           # å…¨ã‚¹ã‚­ãƒ¼ãƒã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â””â”€â”€ types/
    â”œâ”€â”€ api.ts             # APIå‹å®šç¾©
    â”œâ”€â”€ common.ts          # å…±é€šå‹å®šç¾©
    â””â”€â”€ index.ts
```

### ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢ãƒ«ãƒ¼ãƒ«
- **ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©**: `@shared/schema/ãƒ†ãƒ¼ãƒ–ãƒ«å/tables`ã§Drizzleãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©
- **å‹å®šç¾©**: `@shared/schema/ãƒ†ãƒ¼ãƒ–ãƒ«å/types`ã§ãƒ“ã‚¸ãƒã‚¹å‹å®šç¾©
- **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: `@shared/schema/ãƒ†ãƒ¼ãƒ–ãƒ«å/index`ã§é›†ç´„ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **å…±é€šå‹**: `@shared/types/`ã§APIãƒ»å…±é€šå‹å®šç¾©

### Drizzle ORMã¨ã®é€£æº
- **ã‚¹ã‚­ãƒ¼ãƒå‹**: Drizzleã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰å‹ã‚’è‡ªå‹•ç”Ÿæˆ
- **Zodã‚¹ã‚­ãƒ¼ãƒ**: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚­ãƒ¼ãƒã¨ã®é€£æº
- **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚å‹ãƒã‚§ãƒƒã‚¯

### å‹å®šç¾©ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// Drizzleã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰å‹ã‚’ç”Ÿæˆ
import { users } from '@shared/schema/user/tables';

export type User = typeof users.$inferSelect;
export type InsertUser = typeof users.$inferInsert;

// Zodã‚¹ã‚­ãƒ¼ãƒã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
import { z } from 'zod';
import { createInsertSchema } from 'drizzle-zod';

export const insertUserSchema = createInsertSchema(users).omit({
  id: true,
  createdAt: true,
  updatedAt: true
});

export type CreateUserData = z.infer<typeof insertUserSchema>;
```

### ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// ã‚¹ã‚­ãƒ¼ãƒé–¢é€£ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { users } from '@shared/schema/user/tables';
import { customers } from '@shared/schema/customer/tables';

// å…±é€šå‹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { ApiResponse, PaginatedResponse } from '@shared/types/api';
import { User, Customer } from '@shared/types/common';
```

## ğŸ”„ çŠ¶æ…‹ç®¡ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…±é€šçŠ¶æ…‹å‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹**: èªè¨¼ãƒ»èªå¯æƒ…å ±
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹**: ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹**: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥

### çŠ¶æ…‹å‹è¨­è¨ˆ
```typescript
// ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹
export interface UserState {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  error: string | null;
}

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
export interface AppState {
  theme: 'light' | 'dark';
  language: 'ja' | 'en';
  notifications: Notification[];
}

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ…‹
export interface CacheState<T> {
  data: T | null;
  isLoading: boolean;
  error: string | null;
  lastUpdated: Date | null;
}
```

## ğŸ” èªè¨¼ãƒ»èªå¯å‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### èªè¨¼ãƒ»èªå¯å‹
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™**: ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **CSRFä¿è­·**: ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‹è¨­è¨ˆ
```typescript
// æ¨©é™å‹
export interface Permission {
  resource: string;
  action: 'read' | 'write' | 'delete' | 'admin';
}

export interface Role {
  id: string;
  name: string;
  permissions: Permission[];
}

// ã‚»ãƒƒã‚·ãƒ§ãƒ³å‹
export interface SessionData {
  userId: string;
  sessionId: string;
  expiresAt: Date;
  permissions: Permission[];
}

// CSRFå‹
export interface CsrfToken {
  token: string;
  expiresAt: Date;
}
```

## ğŸ“ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Zodã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ
- **å…¥åŠ›æ¤œè¨¼**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®æ¤œè¨¼
- **APIæ¤œè¨¼**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œè¨¼**: ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§æ¤œè¨¼

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‹è¨­è¨ˆ
```typescript
// å…±é€šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
export const emailSchema = z.string().email();
export const passwordSchema = z.string().min(8).max(128);
export const idSchema = z.string().uuid();

// ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
export interface ValidationError {
  field: string;
  message: string;
  code: string;
}

export interface ValidationErrorResponse {
  success: false;
  message: 'Validation failed';
  errors: ValidationError[];
}
```

## ğŸ“¦ å…±é€šãƒ‡ãƒ¼ã‚¿å‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‹
- **æ—¥æ™‚å‹**: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¯¾å¿œ
- **é€šè²¨å‹**: é‡‘é¡è¨ˆç®—
- **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‹**: è¡¨ç¤ºç”¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å‹è¨­è¨ˆ
```typescript
// æ—¥æ™‚å‹
export type DateTime = Date | string;
export type Timezone = 'UTC' | 'Asia/Tokyo';

// é€šè²¨å‹
export interface Money {
  amount: number;
  currency: 'JPY' | 'USD' | 'EUR';
}

// ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‹
export interface DateFormat {
  format: 'YYYY-MM-DD' | 'MM/DD/YYYY' | 'DD/MM/YYYY';
  timezone: Timezone;
}
```