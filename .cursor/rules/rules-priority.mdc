---
description: ルール優先順位と適用範囲
alwaysApply: true
---

# ルール優先順位

## 🚨 ルール優先順位（上から下へ）

### 必須ルール（Rules）- 常時適用
1. **rules-security.mdc**: セキュリティ必須ルール（最優先）
2. **rules-static-analysis.mdc**: 静的解析必須ルール（要約）
3. **rules-code-quality.mdc**: コード品質管理必須ルール（要約）
4. **rules-api.mdc**: API呼び出し必須ルール
5. **rules-authentication.mdc**: 認証必須ルール
6. **rules-database.mdc**: データベース必須ルール
7. **rules-coding.mdc**: コーディング必須ルール
8. **rules-design.mdc**: デザイン実装必須ルール（要約）

### アーキテクチャ設計（Architecture）- 常時適用
9. **architecture-layers.mdc**: アーキテクチャ層設計（3層概要）

### タスク時スキル参照
以下の場合は該当スキルを参照すること：

- **テーブル変更時** → `table-modification` スキル
- **ブラウザ確認時** → `browser-verification` スキル
- **デザイン詳細** → `design-implementation` スキル
- **静的解析詳細** → `static-analysis-workflow` スキル
- **コード品質詳細** → `code-quality-workflow` スキル
- **新規API追加・バックエンド設計** → `architecture-backend` スキル
- **新規画面・フロントエンド設計** → `architecture-frontend` スキル
- **ミドルウェア設計** → `architecture-middleware` スキル
- **リポジトリ・DB操作設計** → `architecture-storage` スキル
- **共通型・スキーマ設計** → `architecture-shared` スキル
- **フロントエンド設計判断** → `guidelines-frontend` スキル
- **バックエンド設計判断** → `guidelines-backend` スキル
- **パフォーマンス改善** → `guidelines-performance` スキル
- **エラーハンドリング設計** → `guidelines-error-handling` スキル
- **日付・時刻実装** → `guidelines-date-time` スキル

## 📋 ルール適用時の注意事項

### 基本原則
- **上位ルールが下位ルールより優先される**
- **矛盾するルールがある場合は上位ルールを採用**
- **セキュリティルールは最優先で適用**
- **新しい機能実装時は既存実装を参考にする**
- **不明な場合は既存の実装パターンに従う**

### ルール分類の使い分け

#### 必須ルール（Rules）
- **性質**: 絶対に守らなければならない
- **違反時**: エラー、警告、システムの不具合
- **例外**: 基本的に例外は認められない
- **例**: `apiRequest`の使用、認証チェック、セキュリティ対策

#### 推奨ガイドライン（Guidelines）
- **性質**: 可能な限り従うが、状況に応じて柔軟に対応可能
- **違反時**: 品質の低下、一貫性の欠如
- **例外**: 合理的な理由があれば例外を認める
- **例**: 命名規則、コンポーネント設計、エラーハンドリング

#### アーキテクチャ設計（Architecture）
- **性質**: システム全体の設計思想
- **目的**: 一貫した設計パターンの維持
- **適用**: 新機能開発時の設計指針
- **例**: 3層アーキテクチャ、責務分離、依存関係

## 🔧 実装時の適用順序

### 新機能開発時
1. **セキュリティルール**: セキュリティ要件の確認
2. **APIルール**: API呼び出しパターンの確認
3. **認証ルール**: 認証・認可の実装
4. **データベースルール**: データアクセスの実装
5. **アーキテクチャ**: 設計パターンの適用
6. **ガイドライン**: コーディング規約の適用

### トラブルシューティング時
1. **セキュリティルール**: セキュリティ問題の確認
2. **APIルール**: API呼び出し問題の確認
3. **認証ルール**: 認証問題の確認
4. **データベースルール**: データアクセス問題の確認
5. **ガイドライン**: 実装パターンの確認

## ✅ ルール遵守チェックリスト

### 必須ルール遵守（常時）
- [ ] セキュリティルールの遵守
- [ ] 静的解析ルールの遵守（詳細は `static-analysis-workflow` スキル参照）
- [ ] コード品質管理ルールの遵守（詳細は `code-quality-workflow` スキル参照）
- [ ] APIルールの遵守
- [ ] 認証ルールの遵守
- [ ] データベースルールの遵守
- [ ] コーディングルールの遵守
- [ ] デザイン実装ルールの遵守（詳細は `design-implementation` スキル参照）
- [ ] アーキテクチャ層設計の適用

### タスク時スキル参照
- [ ] テーブル変更時 → `table-modification` スキルを参照
- [ ] ブラウザ確認時 → `browser-verification` スキルを参照
- [ ] 新規設計・リファクタ時 → 該当の architecture 系 / guidelines 系スキルを参照