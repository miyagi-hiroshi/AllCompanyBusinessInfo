# コミット前チェックガイドライン

## 🔄 フック設定推奨事項

### Husky + lint-staged設定
- **Husky**: Gitフックの管理と実行
- **lint-staged**: ステージングされたファイルのみチェック
- **段階的実行**: 型チェック → ESLint → フォーマット
- **エラー時停止**: 問題がある場合はコミット拒否

### 段階的チェック実行
1. **型チェック**: TypeScript型エラーの検出
2. **品質チェック**: ESLintによるコード品質チェック
3. **フォーマット**: Prettierによる自動フォーマット
4. **セキュリティ**: セキュリティ脆弱性のチェック

### エラー時の適切な処理
- **自動修正**: 修正可能な問題の自動修正
- **エラー表示**: 修正不可能な問題の明確な表示
- **ガイダンス**: 修正方法の具体的な指示
- **ログ出力**: 詳細なエラー情報の提供

### パフォーマンス考慮
- **並列実行**: 可能な限りの並列処理
- **キャッシュ活用**: 型情報・ESLintキャッシュの活用
- **最小限チェック**: ステージングファイルのみのチェック
- **タイムアウト**: 長時間実行の防止

## 📋 チェック項目推奨事項

### 型チェック必須実行
- **TypeScript型チェック**: `tsc --noEmit --project tsconfig.eslint.json`
- **型エラー検出**: 型安全性の確保
- **型定義確認**: 型定義の整合性確認
- **型推論確認**: 型推論の正確性確認

### コード品質チェック
- **ESLint実行**: `eslint --fix`による自動修正
- **ルール違反検出**: コーディング規約の遵守確認
- **未使用コード**: 未使用変数・関数の検出
- **複雑度チェック**: コード複雑度の確認

### フォーマット自動修正
- **Prettier実行**: `prettier --write`による自動フォーマット
- **インデント統一**: 一貫したインデント設定
- **クォート統一**: 一貫したクォート設定
- **セミコロン統一**: 一貫したセミコロン設定

### セキュリティチェック
- **脆弱性スキャン**: 既知の脆弱性の検出
- **依存関係チェック**: 依存関係の脆弱性確認
- **機密情報チェック**: 機密情報の漏洩防止
- **セキュリティルール**: セキュリティ関連ルールの確認

## 🎯 運用推奨事項

### 開発者体験の向上
- **明確なエラーメッセージ**: 分かりやすいエラー表示
- **修正ガイダンス**: 具体的な修正方法の提示
- **自動修正**: 可能な限りの自動修正
- **進捗表示**: チェック進行状況の表示

### エラー時の明確な指示
- **エラー種別**: エラーの種類と重要度の明示
- **修正方法**: 具体的な修正手順の提示
- **参考情報**: 関連ドキュメント・リソースの提供
- **サポート**: チーム内サポート体制の整備

### 自動修正の活用
- **ESLint自動修正**: `--fix`オプションの活用
- **Prettier自動フォーマット**: 自動フォーマットの実行
- **インポート自動ソート**: インポート順序の自動整理
- **未使用コード削除**: 未使用インポートの自動削除

### チーム内ルール統一
- **統一設定**: 全メンバーが同じ設定を使用
- **教育・研修**: ルール理解の徹底
- **ベストプラクティス**: 継続的な知識共有
- **フィードバック**: ルール改善の提案・反映

## 🔧 推奨設定例

### package.json設定
```json
{
  "scripts": {
    "prepare": "husky",
    "typecheck": "tsc --noEmit --project tsconfig.eslint.json",
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx,json,css,md}\""
  },
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,css}": [
      "prettier --write"
    ]
  }
}
```

### .husky/pre-commit設定
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# 型チェック実行
echo "🔍 Running TypeScript type check..."
npm run typecheck

# lint-staged実行
echo "🔧 Running lint-staged..."
npx lint-staged

echo "✅ Pre-commit checks completed successfully!"
```

### .husky/commit-msg設定
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# コミットメッセージの形式チェック
# 例: feat:, fix:, docs:, style:, refactor:, test:, chore:
if ! echo "$1" | grep -qE '^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+'; then
  echo "❌ Invalid commit message format!"
  echo "Format: type(scope): description"
  echo "Types: feat, fix, docs, style, refactor, test, chore"
  exit 1
fi

echo "✅ Commit message format is valid!"
```

## 📊 チェックフロー詳細

### 段階的実行フロー
```mermaid
graph TD
    A[Git Commit] --> B[Pre-commit Hook]
    B --> C[TypeScript Type Check]
    C --> D{Type Errors?}
    D -->|Yes| E[Show Type Errors]
    D -->|No| F[ESLint Check]
    F --> G{ESLint Errors?}
    G -->|Yes| H[Auto Fix + Show Errors]
    G -->|No| I[Prettier Format]
    I --> J[Commit Success]
    E --> K[Commit Blocked]
    H --> K
```

### エラー処理フロー
1. **型エラー検出**: TypeScript型チェック実行
2. **エラー表示**: 具体的なエラー情報の表示
3. **修正ガイダンス**: 修正方法の提示
4. **コミット停止**: エラー修正までコミット拒否

### 自動修正フロー
1. **ESLint自動修正**: 修正可能な問題の自動修正
2. **Prettier自動フォーマット**: コードフォーマットの自動修正
3. **インポート自動ソート**: インポート順序の自動整理
4. **コミット継続**: 修正完了後のコミット実行

## 🚨 トラブルシューティング

### よくある問題と解決策

#### 型チェックエラー
- **原因**: TypeScript型定義の問題
- **解決**: 型定義の修正・追加
- **対策**: 型安全性の向上

#### ESLintエラー
- **原因**: コーディング規約違反
- **解決**: ESLintルールに従った修正
- **対策**: 自動修正の活用

#### フォーマット違反
- **原因**: コードフォーマットの不統一
- **解決**: Prettierによる自動修正
- **対策**: 保存時自動フォーマットの設定

#### パフォーマンス問題
- **原因**: 大量ファイルでのチェック
- **解決**: lint-stagedによる最小限チェック
- **対策**: キャッシュの活用

### 緊急時の対応
- **緊急修正**: `--no-verify`オプションでのコミット
- **後処理**: コミット後の品質チェック実行
- **記録**: 緊急対応の記録・報告
- **改善**: 緊急対応の原因分析・改善

## 📈 継続的改善

### メトリクス監視
- **チェック時間**: コミット前チェックの実行時間
- **エラー率**: チェックエラーの発生率
- **自動修正率**: 自動修正可能な問題の割合
- **開発者満足度**: 開発者からのフィードバック

### 設定最適化
- **ルール調整**: プロジェクトに適したルール設定
- **パフォーマンス改善**: チェック時間の短縮
- **自動化推進**: 手動作業の自動化
- **ユーザビリティ向上**: 開発者体験の改善

### チーム教育
- **ルール理解**: チェックルールの理解促進
- **ベストプラクティス**: 効率的な開発方法の共有
- **トラブルシューティング**: 問題解決方法の共有
- **継続学習**: 最新ツール・技術の学習

### ツール更新
- **定期的更新**: ツール・プラグインの定期的更新
- **新機能活用**: 新機能の積極的活用
- **設定見直し**: 設定の定期的見直し
- **最適化**: 継続的な最適化の実施