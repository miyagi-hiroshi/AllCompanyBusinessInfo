---
description: コード品質管理必須ルール
---

# コード品質必須ルール

## 🚫 絶対禁止事項

### 絶対禁止
- **警告チェックなしのコミット**
- **警告を放置したままの新規実装**
- **デバッグログを残したままのコミット**
- **未使用変数・インポートの放置**
- **any型の使用**（サーバー側の特定ケースを除く）

## 🔧 AI修正後の必須ワークフロー

### コミット前必須チェック

AIがコードを修正した後、コミット前に以下を**必ず**実行すること：

#### 1. ESLint警告チェック
```bash
npm run lint
```

#### 2. 警告の確認と分類
- **警告総数の確認**
- **新規警告の有無を確認**
- **優先度別に分類**

#### 3. 即座に修正可能な警告を修正

以下の警告は**必ず修正してからコミット**すること：

##### 未使用変数・インポートの削除
```typescript
// ❌ 削除前
import { pgTable, pgSchema } from "drizzle-orm/pg-core";

// ✅ 削除後（pgTableが未使用の場合）
import { pgSchema } from "drizzle-orm/pg-core";
```

##### デバッグ用console.logの削除
```typescript
// ❌ 削除前
console.log("🔄 デバッグ情報:", data);

// ✅ 削除後（本番環境では不要なログは削除）
// ログを完全に削除
```

**例外**: エラーログ（`console.error`、`console.warn`）は残す

#### 4. 修正不可能な警告の対応

以下の警告は即座に修正できない場合、**ユーザーに報告**すること：

- `any`型の使用
- 型安全性の欠如（`@typescript-eslint/no-unsafe-*`）
- Promise型の誤った使用（`@typescript-eslint/no-misused-promises`）

**報告内容**:
- 警告の種類と件数
- 警告が発生しているファイル
- 推奨される修正方法
- 優先度

#### 5. コミット

すべての即座修正可能な警告を修正した後、コミットを実行すること。

## 📊 新規実装時の必須ルール

### コーディング時の必須事項

#### 型定義必須
- **any型の使用禁止**（サーバー側を除く）
- **型を明示的に定義**
- **型安全なコードを書く**

#### 例：型定義の良い例
```typescript
// ✅ 良い例
interface User {
  id: string;
  email: string;
  name: string;
}

async function fetchUser(id: string): Promise<User> {
  const res = await apiRequest("GET", `/api/users/${id}`, undefined);
  const result = await res.json();
  return result.data;
}

// ❌ 悪い例
async function fetchUser(id: any): Promise<any> {
  const res = await apiRequest("GET", `/api/users/${id}`, undefined);
  return res.json();
}
```

#### デバッグログの管理
- **デバッグ用ログは開発時のみ**
- **コミット前に削除**
- **本番環境で必要なログのみ残す**

#### 未使用変数・インポートの削除
- **使用していない変数は定義しない**
- **使用していないインポートは削除**

## 🎯 警告の優先度

### 優先度1（即座に修正必須）

以下の警告は**コミット前に必ず修正**すること：

- **未使用変数**: `@typescript-eslint/no-unused-vars`
- **デバッグログ**: `no-console`（`console.log`のみ）
- **未使用インポート**: 使用していないインポート

### 優先度2（計画的に修正）

以下の警告は**計画的に修正**すること：

- **any型の使用**: `@typescript-eslint/no-explicit-any`
- **型安全性の欠如**: `@typescript-eslint/no-unsafe-*`
- **型推論の問題**: `@typescript-eslint/no-unsafe-assignment`等

### 優先度3（長期改善）

以下の警告は**長期的に改善**すること：

- **Promise型の誤使用**: `@typescript-eslint/no-misused-promises`
- **React Fast Refresh**: `react-refresh/only-export-components`
- **パフォーマンス最適化**: その他の警告

## 📋 実装例

### AI修正後の確認手順例

```bash
# 1. ESLint警告チェック
npm run lint

# 2. 警告数を確認
# 出力例: ✖ 535 problems (0 errors, 535 warnings)

# 3. 未使用変数を削除
# 該当ファイルを確認して修正

# 4. デバッグログを削除
# console.log を削除

# 5. 再度チェック
npm run lint

# 6. 警告が減少したことを確認
# 出力例: ✖ 520 problems (0 errors, 520 warnings)

# 7. コミット
git add .
git commit -m "fix: remove unused variables and debug logs"
```

## 🔄 定期的な改善

### 週次レビュー

- **警告総数の確認**
- **新規警告の有無**
- **優先度2の警告を段階的に修正**

### 月次レビュー

- **警告総数の推移確認**
- **優先度3の警告対応計画**
- **コード品質の全体評価**

## ✅ チェックリスト

### コミット前チェックリスト

- [ ] `npm run lint`を実行
- [ ] 未使用変数・インポートを削除
- [ ] デバッグ用`console.log`を削除
- [ ] 新規警告が発生していないか確認
- [ ] 修正不可能な警告をユーザーに報告（該当する場合）
- [ ] すべての即座修正可能な警告を修正

### 新規実装時チェックリスト

- [ ] 型を明示的に定義
- [ ] `any`型を使用していない
- [ ] デバッグログを残していない
- [ ] 未使用変数・インポートがない
- [ ] 型安全なコードを書いている
